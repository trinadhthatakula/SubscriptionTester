<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Valhalla Billing V8 | Integration Guide</title>
    <style>
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --border-color: #30363d;
            --text-primary: #c9d1d9;
            --text-secondary: #8b949e;
            --accent-color: #58a6ff;
            --success-color: #238636;
            --danger-color: #f85149;
            --code-bg: #1f2428;
            --warning-bg: #2d2514;
            --warning-text: #e3b341;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Typography */
        h1, h2, h3 { color: var(--text-primary); margin-top: 2rem; }
        h1 { font-size: 2.5rem; border-bottom: 1px solid var(--border-color); padding-bottom: 1rem; }
        h2 { font-size: 1.75rem; border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem; margin-top: 3rem; }
        a { color: var(--accent-color); text-decoration: none; }
        a:hover { text-decoration: underline; }

        /* Architecture Diagram (CSS Only) */
        .architecture {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-secondary);
            padding: 2rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            margin: 2rem 0;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .node {
            background: var(--code-bg);
            border: 1px solid var(--accent-color);
            color: var(--accent-color);
            padding: 1rem;
            border-radius: 6px;
            font-weight: bold;
            text-align: center;
            flex: 1;
            min-width: 120px;
            position: relative;
        }

        .arrow { font-size: 1.5rem; color: var(--text-secondary); }

        /* Status Cards */
        .alert {
            padding: 1rem;
            border-radius: 6px;
            margin: 1.5rem 0;
            border-left: 5px solid;
        }
        .alert-warning { background: var(--warning-bg); border-color: var(--warning-text); color: var(--text-primary); }
        .alert-danger { background: rgba(248, 81, 73, 0.1); border-color: var(--danger-color); }

        /* Code Blocks */
        pre {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 1rem;
            overflow-x: auto;
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
            font-size: 0.9rem;
        }
        code { font-family: inherit; color: var(--text-primary); }
        .keyword { color: #ff7b72; }
        .string { color: #a5d6ff; }
        .comment { color: #8b949e; font-style: italic; }

        /* Checklist */
        ul.checklist { list-style: none; padding: 0; }
        ul.checklist li {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
        }
        ul.checklist li:before {
            content: "⬜";
            margin-right: 10px;
            font-size: 1.2rem;
        }

        footer {
            margin-top: 4rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-color);
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
    </style>
</head>
<body>

<div class="container">

    <header>
        <h1>Valhalla Billing V8</h1>
        <p>A production-ready, open-source implementation of <strong>Google Play Billing Library 8.3.0</strong>. Designed for Android developers who want to monetize without the headache.</p>
        <p>
            <span style="background: #1f6feb; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem;">Kotlin</span>
            <span style="background: #238636; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem;">Koin</span>
            <span style="background: #9e6a03; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem;">Jetpack Compose</span>
        </p>
    </header>

    <section>
        <h2>The Architecture</h2>
        <p>This project uses a unidirectional data flow to keep your purchase logic sane.</p>

        <div class="architecture">
            <div class="node">Google Play<br><small>(Server)</small></div>
            <div class="arrow">↔</div>
            <div class="node">BillingHelper<br><small>(Data Layer)</small></div>
            <div class="arrow">→</div>
            <div class="node">ViewModel<br><small>(State Holder)</small></div>
            <div class="arrow">→</div>
            <div class="node">Compose UI<br><small>(View)</small></div>
        </div>
    </section>

    <section>
        <h2>Setup Checklist (The Ruthless Protocol)</h2>
        <div class="alert alert-danger">
            <strong>CRITICAL WARNING:</strong> 99% of "Item Unavailable" errors happen because you skipped step 3 or 4. Do not skip them.
        </div>

        <ul class="checklist">
            <li><strong>1. Product IDs:</strong> Ensure your Play Console IDs match <code>BillingHelper.kt</code> exactly.
                <br><small>Default: <code>premium_sub</code> (Subscription) and <code>premium_user</code> (One-Time).</small>
            </li>
            <li><strong>2. Signed Build:</strong> You MUST sign your APK/AAB with your <strong>Release Keystore</strong> (or the debug key registered in Play Console). Default debug keys will fail.</li>
            <li><strong>3. Internal Track:</strong> Upload your build to the <strong>Internal Testing</strong> track on the Play Console.</li>
            <li><strong>4. Testers List:</strong> Add your Gmail to the testers list in the Console.</li>
            <li><strong>5. Accept Invite:</strong> <span style="color: var(--danger-color); font-weight: bold;">(MOST COMMON MISTAKE)</span> Open the "Join on Web" link from the testers tab on your phone and click <strong>ACCEPT INVITE</strong>.</li>
            <li><strong>6. License Testing:</strong> Go to <em>Setup > License Testing</em> in Console and add your email. Set response to "RESPOND_NORMALLY".</li>
        </ul>
    </section>

    <section>
        <h2>Integration Guide</h2>

        <h3>1. Dependency Injection (Koin)</h3>
        <p>Add the helper and ViewModel to your Koin module.</p>
        <pre><code><span class="keyword">val</span> appModule = module {
    <span class="comment">// Singleton Billing Client</span>
    single { BillingHelper(androidContext()) }

    <span class="comment">// ViewModel Injection</span>
    viewModel { SubscriptionViewModel(get()) }
}</code></pre>

        <h3>2. ViewModel Usage</h3>
        <p>Observe the UI State to render your screen.</p>
        <pre><code><span class="keyword">class</span> SubscriptionViewModel(helper: BillingHelper) : ViewModel() {
    <span class="keyword">val</span> uiState = helper.productDetailsList.map { ... }

    <span class="keyword">fun</span> buy(activity: Activity, product: ProductDetails) {
        helper.launchPurchaseFlow(activity, product)
    }
}</code></pre>

        <h3>3. Handling Acknowledgment</h3>
        <p>Purchases are automatically acknowledged in <code>BillingHelper.processPurchases()</code>. If you remove this logic, Google will refund the user after 3 days.</p>
    </section>

    <section>
        <h2>Troubleshooting</h2>
        <div class="alert alert-warning">
            <strong>Issue:</strong> "Billing Unavailable" / Empty List<br>
            <strong>Fix:</strong> You are likely running a standard debug build or haven't accepted the tester invite. See Steps 2 & 5 above.
        </div>
        <div class="alert alert-warning">
            <strong>Issue:</strong> "Feature Not Supported"<br>
            <strong>Fix:</strong> You are likely running on an Emulator without the Play Store installed. Use a physical device or a Play-enabled Emulator image.
        </div>
    </section>

    <footer>
        <p>Built with ❤️ & Rage by Trinadh Thatakula</p>
        <p><a href="https://github.com/trinadhthatakula">github.com/trinadhthatakula</a></p>
    </footer>

</div>

</body>
</html>